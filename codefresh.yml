version: '1.0'
#pubma CI/CD flow
steps:

  setup-builder:
    type: build
    description: create Pumba Go builder image (Go, tools, and libraries)
    dockerfile: Build.Dockerfile
    image-name: verchol/pumba-builder
    tag: cf

  go-pumba:
    description: compile Pumba binary, using builder image
    image: ${{setup-builder}}
    #working-directory: ${{initial-clone}}
    #environment:
    #   - DIST=distcf
    commands:
      - script/go_build.sh
      - echo currnet dir - $PWD
      - echo $GOPATH
      - ls /.dist
      - cp -r /.dist /codefresh/volume/pumba/.dist
  push-step:
    type: push
    description: Free text description
    candidate: ${{setup-builder}}
    tag: cf
    registry: index.docker.io
    credentials:
      username: ${{DOCKER_HUB_USERNAME}}
      password: ${{DOCKER_HUB_PASSWORD}}
    fail-fast: false

  pumba-builder:
    type: build
    description: create Pumba Go builder image (Go, tools, and libraries)
    dockerfile: Dockerfile
    image-name: verchol/pumba
    tag: ${{CF_BRANCH}}

  push-step:
    type: push
    description: Free text description
    candidate: verchol/pumba
    tag: ${{CF_BRANCH}}
    registry: index.docker.io
    credentials:
        username: ${{DOCKER_HUB_USERNAME}}
        password: ${{DOCKER_HUB_PASSWORD}}
    fail-fast: false

  validate-pumba:
    description: compile Pumba binary, using builder image
    image: ${{setup-builder}}
    working-directory: ${{initial-clone}}
    commands:
      - echo current directory - $PWD
      - ls -al
      - ls ./.dist


#  package-pumba:
#    type: build
#    description: build Pumba into Docker container
#    image-name: ${{setup-builder}}
#    tag: cf
